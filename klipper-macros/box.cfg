[serial_485 serial485]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
baud: 230400

[auto_addr]

[box]
bus:serial485
filament_sensor:filament_sensor_2
pre_cut_pos_x:42.0#223.8  
pre_cut_pos_y:160.0#200
cut_pos_x:42.0#223.8    
cut_pos_y:223.7#225
cut_pos_offset:1.3
cut_find_start_offset_y: 6
#middle_cut_pos_y:
Tn_retrude:-60#-1.00#-60       
Tn_retrude_velocity:3600#360  
Tn_extrude_temp: 220  # Extrusion temperature
Tn_extrude: 140    # If current temperature is set, preheat to 120
Tn_extrude_velocity: 360  # Extrusion speed
buffer_empty_len: 30  # Buffer retraction reserved length (distance from cut blade inside extruder to extrusion gear)
clean_left_pos_x:153.5# Teflon wiper left position
clean_left_pos_y:225.3#222.5
clean_right_pos_x:178.0# Teflon wiper right position
clean_right_pos_y:225.3#222.5
clean_velocity: 3600
cut_velocity:8000
#cut_accel:10000
#cut_accel_to_decel:30000
extrude_pos_x:148#150.0#148.0
extrude_pos_y:225.3#200.00
box_first_clean_length:140
box_need_clean_length:140
box_need_clean_length_max:140
has_extrude_pos: 1          # Whether material purging is needed - distinguishes K1_MAX and F008
safe_pos_y: 215#226
# switch_pin:!nozzle_mcu:PB9
#switch_pin:!nozzle_mcu:PA8
switch_pin:nozzle_mcu:PA8
#cr_machine: 1 # default: 0: F008 / 1: K1SE
version: 1
extrude_pos_z:30.0
cut_run_count:1
tn_line_len:40.00
box_extrude_retry_num: 5
retrude_position_x: 42
retrude_position_y: 100

[gcode_macro BOX_CHECK_MATERIAL]
gcode:
  M118 =========================================
  M118 [BOX_CHECK_MATERIAL] Started checking material
  M118 =========================================
  M118 [BOX_CHECK_MATERIAL] Step 1/1: WAIT_EXTRUSION_ALL_MATERIALS
  WAIT_EXTRUSION_ALL_MATERIALS
  M118 ========================================
  M118 [BOX_CHECK_MATERIAL] MACRO END
  M118 =========================================

[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
gcode:
  M118 ========================================
  M118 [BOX_LOAD] Loading material with existing material
  M118 ========================================
  M104
  M118 [BOX_LOAD] Step 1/10: Homing if needed
  IF_NEED_HOME
  M118 [BOX_LOAD] Step 2/10: Clearing errors
  BOX_ERROR_CLEAR
  M118 [BOX_LOAD] Step 3/10: Checking material
  BOX_CHECK_MATERIAL
  M118 [BOX_LOAD] Step 4/10: Cutting material
  BOX_CUT_MATERIAL
  M118 [BOX_LOAD] Step 5/10: Retracting material
  BOX_RETRUDE_MATERIAL
  M118 [BOX_LOAD] Step 6/10: Moving to extrude position
  BOX_GO_TO_EXTRUDE_POS
  M118 [BOX_LOAD] Step 7/10: Extruding material from box
  BOX_EXTRUDE_MATERIAL
  M118 [BOX_LOAD] Step 8/10: Extruding through hotend
  BOX_EXTRUDER_EXTRUDE
  M118 [BOX_LOAD] Step 9/10: Flushing material
  BOX_MATERIAL_FLUSH
  M118 [BOX_LOAD] Step 10/10: Restoring position
  RESTORE_POSITION
  M118 ========================================
  M118 [BOX_LOAD] MACRO END
  M118 ========================================

[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
gcode:
  M118 ========================================
  M118 [BOX_LOAD] Loading material (no existing material)
  M118 ========================================
  M104
  M118 [BOX_LOAD] Step 1/4: Checking material
  BOX_CHECK_MATERIAL
  M118 [BOX_LOAD] Step 2/4: Extruding material from box
  BOX_EXTRUDE_MATERIAL
  M118 [BOX_LOAD] Step 3/4: Extruding through hotend
  BOX_EXTRUDER_EXTRUDE
  M118 [BOX_LOAD] Step 4/4: Flushing material
  BOX_MATERIAL_FLUSH
  M118 ========================================
  M118 [BOX_LOAD] MACRO END
  M118 ========================================

[gcode_macro BOX_QUIT_MATERIAL]
gcode:
  M118 ========================================
  M118 [BOX_QUIT] Started Unloading material
  M118 ========================================
  M118 [BOX_QUIT] Step 1/5: Box error clear
  BOX_ERROR_CLEAR
  M118 [BOX_QUIT] Step 2/5: Checking material
  BOX_CHECK_MATERIAL
  M118 [BOX_QUIT] Step 3/5: Cutting material
  BOX_CUT_MATERIAL
  M118 [BOX_QUIT] Step 4/5: Retracting material
  BOX_RETRUDE_MATERIAL
  M118 [BOX_QUIT] Step 5/5: Moving to box extrude position
  BOX_GO_TO_BOX_EXTRUDE_POS
  M118 ========================================
  M118 [BOX_QUIT] Material unloading DONE
  M118 ========================================  
  ;BOX_RETRUDE_MATERIAL_WITH_TNN
  ;BOX_MOVE_TO_SAFE_POS

# eg:
# BOX_EXTRUDE_MATERIAL TNN=T1A
# BOX_EXTRUDER_EXTRUDE TNN=T1A
# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A

[gcode_macro BOX_INFO_REFRESH]
gcode:
  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
  M400
  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
  M400
  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
  M400

